# Use ARG to set the Python version
ARG PYTHON_VERSION=3.13.11
FROM python:${PYTHON_VERSION}
SHELL ["/bin/bash", "-i", "-c"]

# Define maintainer information
LABEL maintainer="f.batonogov@yandex.ru"

# Define the PyInstaller version and necessary environment variables
ARG PYINSTALLER_VERSION=6.17.0
ENV PYPI_URL=https://pypi.python.org/
ENV PYPI_INDEX_URL=https://pypi.python.org/simple
ENV PYTHONUNBUFFERED=1

# Copy the entrypoint script
COPY entrypoint-linux.sh /entrypoint.sh

# Install PyInstaller (use uv on amd64/arm64, pip on other platforms)
ARG TARGETARCH
RUN if [ "$TARGETARCH" = "amd64" ] || [ "$TARGETARCH" = "arm64" ]; then \
        pip install --no-cache-dir uv==0.10.0 && \
        uv pip install --system --no-cache pyinstaller==$PYINSTALLER_VERSION; \
    else \
        pip install --no-cache-dir pyinstaller==$PYINSTALLER_VERSION; \
    fi && \
    chmod +x /entrypoint.sh

# Set the working directory and mount the volume
VOLUME /src/
WORKDIR /src/

# Set the entrypoint
ENTRYPOINT ["/entrypoint.sh"]
